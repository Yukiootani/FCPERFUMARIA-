<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Banco de Dados</title>
    <style>
        body { font-family: sans-serif; padding: 30px; text-align: center; background: #f0f0f0; }
        button { padding: 20px; font-size: 18px; background: #007bff; color: white; border: none; border-radius: 8px; width: 100%; cursor: pointer; }
        #log { margin-top: 20px; padding: 15px; background: #fff; border: 1px solid #ccc; text-align: left; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h2>Diagnóstico de Escrita</h2>
    <p>Vamos tentar criar a pasta na força.</p>
    
    <button onclick="testarGravacao()">TESTAR GRAVAÇÃO NO FIREBASE</button>
    
    <div id="log">Aguardando...</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyDxyqFLm08rqlaemlyYI9gQfrjvddPelJs", 
            authDomain: "fc-perfumaria-309fb.firebaseapp.com", 
            projectId: "fc-perfumaria-309fb", 
            storageBucket: "fc-perfumaria-309fb.firebasestorage.app", 
            messagingSenderId: "311935363734", 
            appId: "1:311935363734:web:a85cf6ccd93c67d594f0b7" 
        };
        
        try { firebase.initializeApp(firebaseConfig); } catch(e){ document.getElementById('log').innerText = e.message; }
        const db = firebase.firestore();

        async function testarGravacao() {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = "⏳ Tentando conectar e gravar...";
            
            try {
                // Tenta criar um documento de teste na pasta push_tokens
                await db.collection('push_tokens').doc('teste_manual_' + Date.now()).set({
                    token: "TOKEN_DE_TESTE_MANUAL",
                    criadoEm: new Date().toString(),
                    device: navigator.userAgent
                });
                
                logDiv.innerHTML = "✅ SUCESSO! Gravação funcionou.\n\nVá no Firebase agora e atualize a página. A pasta 'push_tokens' DEVE estar lá.";
                logDiv.style.color = "green";
                logDiv.style.fontWeight = "bold";
                
            } catch (error) {
                console.error(error);
                logDiv.innerHTML = "❌ ERRO DE GRAVAÇÃO:\n" + error.message + "\n\nCódigo do erro: " + error.code;
                
                if(error.code === 'permission-denied') {
                    logDiv.innerHTML += "\n\nSOLUÇÃO: Suas Regras (Rules) no Firebase estão bloqueando. Você precisa liberar a escrita.";
                }
                logDiv.style.color = "red";
            }
        }
    </script>
</body>
</html>
